<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>æŠŠå­—å¥è¯­æ³•æ¸¸æˆ - æˆ¿é—´æ•´ç†å¤§æŒ‘æˆ˜</title>
  <style>
    /* ====== åŸºç¡€æ ·å¼ ====== */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Microsoft YaHei", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;
      color: #223;
      background: linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
    }

    .shell {
      width: 100%;
      max-width: 1100px;
    }

    header {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: #2c3e50;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
      padding: 22px 24px;
      text-align: center;
    }
    header h1 {
      margin: 0 0 8px 0;
      font-size: clamp(22px, 3.2vw, 34px);
      text-shadow: 0 2px 6px rgba(0,0,0,.15);
    }
    header p { margin: 0; opacity: .9; }

    .card {
      margin-top: 18px;
      background: rgba(255,255,255,.96);
      border-radius: 16px;
      box-shadow: 0 12px 24px rgba(0,0,0,.18);
      padding: 18px;
    }

    /* ====== è¯´æ˜åŒº ====== */
    .instructions {
      border-left: 6px solid #4caf50;
      background: #f7faf7;
      border-radius: 12px;
      padding: 14px 16px;
    }
    .instructions h2 {
      margin: 0 0 8px 0; color: #2f7d32; font-size: 18px;
    }
    .instructions ul { margin: 8px 0 0 20px; }
    .instructions li { margin: 6px 0; line-height: 1.6; }

    /* ====== ä¸»æ¸¸æˆåŒºåŸŸ ====== */
    .game {
      display: grid;
      gap: 18px;
      grid-template-columns: 1.6fr 1fr;
      margin-top: 16px;
    }
    @media (max-width: 900px) {
      .game { grid-template-columns: 1fr; }
    }

    /* ====== æˆ¿é—´åŒºåŸŸ ====== */
    .room-wrap {
      background: #eef2f7;
      border-radius: 14px;
      border: 3px dashed #6c757d;
      padding: 14px;
    }
    .room-wrap h3 { margin: 0 0 10px 0; color:#334; }
    .room {
      position: relative;
      height: 420px;
      border-radius: 12px;
      overflow: hidden;
      background:
        radial-gradient(1000px 300px at bottom, #d1e7ff 0%, #b7d7ff 30%, #a6cffc 60%, #9fc6ff 100%);
    }

    /* ç›®æ ‡åŒºåŸŸ */
    .target {
      position: absolute;
      border: 2px dashed #4caf50;
      background: rgba(76,175,80,.08);
      color: #2f7d32;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-weight: 700;
      user-select: none;
      transition: transform .1s ease;
    }
    .target.flash { animation: flash .6s ease; }
    @keyframes flash {
      0%,100% { box-shadow: 0 0 0 rgba(76,175,80,0); }
      50% { box-shadow: 0 0 0 6px rgba(76,175,80,.2); }
    }

    /* ç‰©å“ï¼ˆæ”¯æŒåŸç”Ÿæ‹–æ‹½ï¼‰ */
    .item {
      position: absolute;
      min-width: 86px;
      padding: 6px 8px;
      background: rgba(255,255,255,.92);
      border-radius: 10px;
      box-shadow: 0 8px 18px rgba(0,0,0,.15);
      text-align: center;
      font-weight: 700;
      cursor: grab;
      user-select: none;
      transition: transform .15s ease, box-shadow .15s ease, opacity .2s ease;
    }
    .item:active {
      cursor: grabbing;
      transform: scale(1.06);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      z-index: 50;
    }
    .item .emoji { display: block; font-size: 38px; line-height: 1.1; }
    .item .label { font-size: 16px; color: #334; }

    /* ====== æ§åˆ¶åŒº ====== */
    .panel {
      background: #f8f9fa;
      border-radius: 14px;
      padding: 14px;
    }
    .sentence-box {
      min-height: 120px;
      background: #fff;
      border: 2px solid #e7e9ee;
      border-radius: 12px;
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      text-align: center;
    }
    .bubble {
      background: #e9edf3;
      color: #223;
      padding: 8px 14px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .bubble.ba { background: #ffd166; color: #2d2a00; font-weight: 800; }
    .bubble.ok { background: #e6f6ea; color: #1b5e20; }
    .bubble.bad { background: #ffe9ea; color: #8b0000; }

    .btn {
      width: 100%;
      border: 0;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
      margin-top: 10px;
    }
    .btn:active { transform: translateY(1px); }
    .btn-check { background: #4caf50; color: #fff; box-shadow: 0 6px 16px rgba(76,175,80,.35); }
    .btn-check:hover { background: #429e47; }
    .btn-reset { background: #f94144; color: #fff; box-shadow: 0 6px 16px rgba(249,65,68,.35); }
    .btn-reset:hover { background: #e63a3d; }

    .grammar {
      margin-top: 14px;
      background: #eef6ff;
      border-left: 6px solid #2196f3;
      border-radius: 10px;
      padding: 12px;
    }
    .grammar h3 { margin: 0 0 6px 0; color: #1565c0; font-size: 16px; }
    .ex { background:#fff; padding:8px 10px; border-radius:8px; font-style:italic; margin-top:6px; }

    /* ====== æ¼‚æµ®åé¦ˆ ====== */
    .toast {
      position: fixed;
      top: 18px;
      right: 18px;
      transform: translateX(140%);
      transition: transform .25s ease;
      z-index: 9999;
      padding: 12px 16px;
      border-radius: 10px;
      color: #fff;
      font-weight: 800;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
      max-width: 70vw;
      word-break: break-all;
    }
    .toast.show { transform: translateX(0); }
    .toast.ok { background: #2e7d32; }
    .toast.err { background: #c62828; }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <h1>æŠŠå­—å¥è¯­æ³•æ¸¸æˆ - æˆ¿é—´æ•´ç†å¤§æŒ‘æˆ˜</h1>
      <p>æ‹–åŠ¨ç‰©å“ â†’ æ”¾åˆ°åˆé€‚çš„ç›®æ ‡ â†’ è‡ªåŠ¨ç”Ÿæˆâ€œæŠŠâ€å­—å¥ â†’ ç‚¹å‡»æ£€æŸ¥éªŒè¯æ˜¯å¦æ­£ç¡®</p>
    </header>

    <div class="card instructions">
      <h2>æ¸¸æˆè¯´æ˜</h2>
      <ul>
        <li>å°†æˆ¿é—´ä¸­çš„ç‰©å“æ‹–æ‹½åˆ°åˆé€‚çš„ <b>ç›®æ ‡åŒºåŸŸ</b>ã€‚</li>
        <li>ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ â€œä¸»è¯­ + æŠŠ + å®¾è¯­ + åŠ¨è¯ + å…¶ä»–æˆåˆ†â€ çš„å¥å­ã€‚</li>
        <li>è‹¥æ”¾ç½®æ­£ç¡®ï¼Œå¥å­æ ‡è®°ä¸º âœ…ï¼›å¦åˆ™ä¼šæ ‡è®°ä¸º âŒ å¹¶æç¤ºä¸åˆé€‚ã€‚</li>
        <li>ç‚¹å‡»ã€Œæ£€æŸ¥å¥å­ã€å¯åˆ¤æ–­å½“å‰æ‰€æœ‰å¥å­æ˜¯å¦å…¨éƒ¨æ­£ç¡®ï¼›ã€Œé‡ç½®æ¸¸æˆã€å¯é‡æ–°å¼€å§‹ã€‚</li>
      </ul>
      <div style="margin-top:6px;opacity:.9">åŸºæœ¬ç»“æ„ï¼š<b>æˆ‘ + æŠŠ + å®¾è¯­ + åŠ¨è¯ + ä½ç½®æˆåˆ†</b></div>
    </div>

    <div class="card game">
      <!-- å·¦ä¾§ï¼šæˆ¿é—´ -->
      <section class="room-wrap">
        <h3>æˆ‘çš„æˆ¿é—´ï¼ˆæ‹–åŠ¨ç‰©å“åˆ°åˆé€‚çš„ç›®æ ‡åŒºåŸŸï¼‰</h3>
        <div id="room" class="room"></div>
      </section>

      <!-- å³ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
      <aside class="panel">
        <div id="sentences" class="sentence-box">
          <span class="bubble">è¯·å¼€å§‹æ‹–æ”¾ç‰©å“</span>
        </div>
        <button id="btnCheck" class="btn btn-check">æ£€æŸ¥å¥å­</button>
        <button id="btnReset" class="btn btn-reset">é‡ç½®æ¸¸æˆ</button>

        <div class="grammar">
          <h3>â€œæŠŠâ€å­—å¥è¦ç‚¹</h3>
          <div>ç”¨äºå¼ºè°ƒå¯¹å®¾è¯­çš„å¤„ç†æˆ–å¤„ç½®ç»“æœã€‚</div>
          <div>åŠ¨è¯åéœ€å¸¦è¡¥è¯­/ä½ç½®ç­‰æˆåˆ†ï¼Œä¸èƒ½ç”¨â€œå…‰æ†åŠ¨è¯â€ã€‚</div>
          <div class="ex">ä¾‹ï¼šæˆ‘æŠŠä¹¦æ”¾åœ¨ä¹¦æ¶ä¸Šã€‚/ æˆ‘æŠŠè¡£æœæŒ‚åœ¨è¡£æŸœé‡Œã€‚</div>
        </div>
      </aside>
    </div>
  </div>

  <!-- æ¼‚æµ®åé¦ˆ -->
  <div id="toast" class="toast">æç¤º</div>

  <script>
    /*
      â€”â€” ä»£ç æ¦‚è§ˆ â€”â€”
      1) æ•°æ®ï¼šitemsï¼ˆç‰©å“ï¼‰ã€targetsï¼ˆç›®æ ‡åŒºåŸŸï¼‰
      2) åˆå§‹åŒ–ï¼šç»˜åˆ¶ç›®æ ‡åŒºåŸŸ + ç‰©å“åˆ°æˆ¿é—´
      3) äº¤äº’ï¼šåŸç”Ÿ HTML5 æ‹–æ‹½ï¼ˆdragstart/dragover/dropï¼‰
      4) æ”¾ç½®é€»è¾‘ï¼šåˆ¤æ–­æ˜¯å¦è¿›å…¥æŸç›®æ ‡åŒºåŸŸå¹¶è®°å½•çŠ¶æ€
      5) å¥å­ç”Ÿæˆï¼šæ ¹æ® currentState æ¸²æŸ“â€œæŠŠâ€å­—å¥
      6) æ ¡éªŒï¼šå…¨éƒ¨æ­£ç¡®åˆ™é€šè¿‡
    */

    // â€”â€” ç›®æ ‡åŒºåŸŸï¼ˆå«ä½ç½®åç¼€ï¼‰â€”â€”
    // suffix: ä¸Š / é‡Œ
    const TARGETS = [
      { id: 'shelf', name: 'ä¹¦æ¶', x: 28,  y: 40,  w: 120, h: 120, suffix: 'ä¸Š' },
      { id: 'desk',  name: 'æ¡Œå­', x: 210, y: 240, w: 140, h: 90,  suffix: 'ä¸Š' },
      { id: 'closet',name: 'è¡£æŸœ', x: 340, y: 40,  w: 120, h: 160, suffix: 'é‡Œ' },
      { id: 'shoe',  name: 'é‹æ¶', x: 320, y: 240, w: 140, h: 80,  suffix: 'ä¸Š' },
      { id: 'box',   name: 'ç®±å­', x: 160, y: 320, w: 120, h: 80,  suffix: 'é‡Œ' }
    ];

    // â€”â€” ç‰©å“ï¼ˆå¸¦åŠ¨è¯ã€æ­£ç¡®ç›®æ ‡ã€emoji æ˜¾ç¤ºï¼‰â€”â€”
    const ITEMS = [
      { id: 'book',   name: 'ä¹¦',   emoji: 'ğŸ“š', verb: 'æ”¾', correctTarget: 'shelf', top: 70,  left: 70  },
      { id: 'apple',  name: 'è‹¹æœ', emoji: 'ğŸ', verb: 'æ”¾', correctTarget: 'desk',  top: 120, left: 110 },
      { id: 'cloth',  name: 'è¡£æœ', emoji: 'ğŸ‘•', verb: 'æŒ‚', correctTarget: 'closet',top: 210, left: 60  },
      { id: 'shoes',  name: 'é‹å­', emoji: 'ğŸ‘Ÿ', verb: 'æ”¾', correctTarget: 'shoe',  top: 290, left: 120 },
      { id: 'toy',    name: 'ç©å…·', emoji: 'ğŸ§¸', verb: 'æ”¶', correctTarget: 'box',   top: 170, left: 220 }
    ];

    // â€”â€” çŠ¶æ€ï¼šitemId -> { targetId, correct } â€”â€” 
    let state = {};

    const roomEl = document.getElementById('room');
    const sentencesEl = document.getElementById('sentences');
    const toastEl = document.getElementById('toast');
    const btnCheck = document.getElementById('btnCheck');
    const btnReset = document.getElementById('btnReset');

    // å·¥å…·ï¼šæ˜¾ç¤ºæ¼‚æµ®æç¤º
    function toast(msg, type = 'ok', ms = 1800) {
      toastEl.textContent = msg;
      toastEl.className = `toast show ${type === 'ok' ? 'ok' : 'err'}`;
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=>toastEl.classList.remove('show'), ms);
    }

    // åˆå§‹åŒ–ï¼šç»˜åˆ¶ç›®æ ‡ä¸ç‰©å“
    function init() {
      state = {};
      roomEl.innerHTML = '';

      // ç”»ç›®æ ‡åŒºåŸŸ
      TARGETS.forEach(t => {
        const d = document.createElement('div');
        d.className = 'target';
        d.id = `target-${t.id}`;
        d.style.left = t.x + 'px';
        d.style.top  = t.y + 'px';
        d.style.width  = t.w + 'px';
        d.style.height = t.h + 'px';
        d.textContent = t.name;
        roomEl.appendChild(d);
      });

      // ç”»ç‰©å“ï¼ˆå¯æ‹–æ‹½ï¼‰
      ITEMS.forEach(i => {
        const d = document.createElement('div');
        d.className = 'item';
        d.id = `item-${i.id}`;
        d.style.left = i.left + 'px';
        d.style.top  = i.top + 'px';
        d.draggable = true;
        d.innerHTML = `
          <span class="emoji">${i.emoji}</span>
          <span class="label">${i.name}</span>
        `;

        // è®°å½•åŸå§‹åæ ‡ï¼ˆé‡ç½®éœ€è¦ï¼‰
        d.dataset.ox = i.left;
        d.dataset.oy = i.top;

        // æ‹–æ‹½å¼€å§‹
        d.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', d.id);
          setTimeout(()=>{ d.style.opacity = .6; }, 0);
        });

        // æ‹–æ‹½ç»“æŸè¿˜åŸé€æ˜åº¦
        d.addEventListener('dragend', ()=> d.style.opacity = 1);

        roomEl.appendChild(d);
      });

      // æˆ¿é—´ä½œä¸ºæ”¾ç½®å®¹å™¨
      roomEl.addEventListener('dragover', e => e.preventDefault());
      roomEl.addEventListener('drop', onDrop);

      // åˆå§‹å¥å­æç¤º
      renderSentences();
    }

    // æ”¾ç½®äº‹ä»¶ï¼šæ ¹æ®é¼ æ ‡åæ ‡åˆ¤æ–­æ˜¯å¦è¿›å…¥æŸä¸ªç›®æ ‡åŒºåŸŸ
    function onDrop(e) {
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain'); // item-*
      const el = document.getElementById(id);
      if (!el) return;

      const roomRect = roomEl.getBoundingClientRect();
      const x = e.clientX - roomRect.left;
      const y = e.clientY - roomRect.top;

      // è®¾ç½®å…ƒç´ ä½ç½®ï¼ˆä½¿é¼ æ ‡å¤§è‡´è½åœ¨å…ƒç´ ä¸­å¿ƒï¼‰
      el.style.left = (x - el.offsetWidth/2) + 'px';
      el.style.top  = (y - el.offsetHeight/2) + 'px';

      // åˆ¤æ–­æ˜¯å¦æ”¾å…¥æŸç›®æ ‡
      const itemId = id.replace('item-','');
      const item = ITEMS.find(i => i.id === itemId);
      let hitTarget = null;

      TARGETS.forEach(t => {
        const tEl = document.getElementById('target-' + t.id);
        const rect = tEl.getBoundingClientRect();
        const rx = rect.left - roomRect.left;
        const ry = rect.top  - roomRect.top;
        if (x >= rx && x <= rx + t.w && y >= ry && y <= ry + t.h) {
          hitTarget = t;
        }
      });

      if (hitTarget) {
        // é—ªçƒæç¤º
        const tEl = document.getElementById('target-'+hitTarget.id);
        tEl.classList.add('flash');
        setTimeout(()=>tEl.classList.remove('flash'), 600);

        const ok = (hitTarget.id === item.correctTarget);
        state[item.id] = {
          targetId: hitTarget.id,
          correct: ok
        };
        toast(ok ? `âœ… å¾ˆå¥½ï¼ä½ æŠŠ${item.name}æ”¾åœ¨äº†${hitTarget.name}${hitTarget.suffix}` :
                    `âŒ ä½ æŠŠ${item.name}æ”¾åœ¨äº†${hitTarget.name}ï¼Œä¸å¤ªåˆé€‚`, ok ? 'ok' : 'err');
      } else {
        // æ²¡æœ‰å‘½ä¸­ä»»ä½•ç›®æ ‡ï¼Œå–æ¶ˆè¯¥ç‰©å“çš„çŠ¶æ€
        delete state[item.id];
        toast(`å·²æŠŠ ${item.name} æ”¾åˆ°æˆ¿é—´ä¸­ï¼Œä½†æœªå¤„äºä»»ä½•ç›®æ ‡åŒºåŸŸ`, 'err', 1400);
      }

      renderSentences();
    }

    // æ ¹æ® state æ¸²æŸ“å¥å­
    function renderSentences() {
      sentencesEl.innerHTML = '';

      const keys = Object.keys(state);
      if (keys.length === 0) {
        sentencesEl.innerHTML = '<span class="bubble">è¯·å¼€å§‹æ‹–æ”¾ç‰©å“</span>';
        return;
      }

      keys.forEach(itemId => {
        const st = state[itemId];
        const item = ITEMS.find(i => i.id === itemId);
        const target = TARGETS.find(t => t.id === st.targetId);

        const line = document.createElement('div');
        line.style.display = 'flex';
        line.style.flexWrap = 'wrap';
        line.style.justifyContent = 'center';
        line.style.gap = '8px';
        line.style.margin = '4px 0';

        // æˆ‘ + æŠŠ + å®¾è¯­ + åŠ¨è¯ + å…¶ä»–æˆåˆ†
        line.appendChild(makeBubble('æˆ‘'));
        line.appendChild(makeBubble('æŠŠ', 'ba'));
        line.appendChild(makeBubble(item.name));
        line.appendChild(makeBubble(item.verb));
        const pos = `åœ¨${target.name}${target.suffix}`;
        line.appendChild(makeBubble(st.correct ? pos : 'åœ¨ä¸åˆé€‚çš„åœ°æ–¹', st.correct ? 'ok' : 'bad'));

        sentencesEl.appendChild(line);
      });
    }

    function makeBubble(text, type='') {
      const b = document.createElement('span');
      b.className = 'bubble' + (type ? (' '+type) : '');
      b.textContent = text;
      return b;
    }

    // æ£€æŸ¥ï¼šæ˜¯å¦å…¨éƒ¨æ­£ç¡®
    function checkAll() {
      const keys = Object.keys(state);
      if (keys.length === 0) {
        toast('è¯·å…ˆæŠŠè‡³å°‘ä¸€ä¸ªç‰©å“æ‹–åˆ°ç›®æ ‡åŒºåŸŸ~', 'err');
        return;
      }
      const allOk = keys.every(k => state[k].correct);
      toast(allOk ? 'ğŸ‰ å¤ªæ£’äº†ï¼æ‰€æœ‰â€œæŠŠâ€å­—å¥éƒ½æ­£ç¡®ï¼' : 'è¿˜æœ‰ä¸åˆé€‚çš„æ”¾ç½®ï¼Œè¯·å†æ£€æŸ¥ä¸€ä¸‹ï½', allOk ? 'ok' : 'err', 2200);
    }

    // é‡ç½®ï¼šæ¢å¤åˆå§‹ä½ç½®ä¸çŠ¶æ€
    function resetGame() {
      state = {};
      // è¿˜åŸç‰©å“ä½ç½®
      ITEMS.forEach(i => {
        const el = document.getElementById('item-'+i.id);
        if (el) {
          el.style.left = el.dataset.ox + 'px';
          el.style.top  = el.dataset.oy + 'px';
        }
      });
      renderSentences();
      toast('å·²é‡ç½®æ¸¸æˆï¼Œå¼€å§‹æ–°çš„æ•´ç†æŒ‘æˆ˜å§ï¼', 'ok');
    }

    // äº‹ä»¶ç»‘å®š
    btnCheck.addEventListener('click', checkAll);
    btnReset.addEventListener('click', resetGame);

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
